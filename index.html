<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikipedia Path Finder Game</title>

    <!-- Link to external CSS -->
    <link rel="stylesheet" href="styles.css">

    <script>
        let currentPage = "Main_Page";  // Starting page (Main Page)
        let targetPage = "";
        let moveCount = 0;  // This will track the number of moves (or iframe clicks)

        // Function to generate a random Wikipedia page name
        // Function to replace underscores with spaces
function replaceUnderscoresWithSpaces(text) {
    return text.replace(/_/g, ' ');
}

// Modify the generateRandomPage function to apply this to currentPage and targetPage
async function generateRandomPage() {
    const randomPages = [
        "Python_(programming_language)",
        "Breadth-first_search",
        "Artificial_intelligence",
        "Machine_learning",
        "Quantum_computing",
        "History_of_computing",
        "Blockchain",
        "OpenAI",
        "Internet",
        "Tesla,_Inc."
    ];

    targetPage = randomPages[Math.floor(Math.random() * randomPages.length)];
    document.getElementById("targetPage").textContent = replaceUnderscoresWithSpaces(targetPage);
    document.getElementById("currentPage").textContent = replaceUnderscoresWithSpaces(currentPage);
    document.getElementById("moveCount").textContent = `Moves: ${moveCount}`;

    updateIframe(currentPage);
}

        // Function to fetch links from the current page (using the Wikipedia API)
        async function navigateToPage(newPage) {
    if (newPage === targetPage) {
        alert("You reached the target page!");
        return;
    }

    currentPage = newPage;
    moveCount++;  // Increment move count for each new page

    // Update move count display
    document.getElementById("moveCount").textContent = `Moves: ${moveCount}`;

    // Update available links for the new page
    const links = await getLinks(currentPage);
    updateLinks(links);

    // Update the displayed page name with spaces
    document.getElementById("currentPage").textContent = replaceUnderscoresWithSpaces(currentPage);

    // Update iframe with the new page
    updateIframe(currentPage);
}

        // Function to handle navigation
        async function navigateToPage(newPage) {
            if (newPage === targetPage) {
                alert("You reached the target page!");
                return;
            }

            currentPage = newPage;
            moveCount++;  // Increment move count for each new page

            document.getElementById("moveCount").textContent = `Moves: ${moveCount}`;

            const links = await getLinks(currentPage);
            updateLinks(links);

            updateIframe(currentPage);
        }

        // Function to update the iframe URL based on the current page
        function updateIframe(page) {
            const iframe = document.getElementById("wikiIframe");
            iframe.src = `https://en.wikipedia.org/wiki/${encodeURIComponent(page)}`;
        }

        // Function to track iframe clicks
        function trackIframeClicks() {
            const iframe = document.getElementById("wikiIframe");

            iframe.onload = () => {
                moveCount++;
                document.getElementById("moveCount").textContent = `Moves: ${moveCount}`;
            };
        }

        // Function to update the available links on the page
        function updateLinks(links) {
            const linksList = document.getElementById("linksList");
            linksList.innerHTML = "";

            links.forEach(link => {
                const listItem = document.createElement("li");
                const linkElement = document.createElement("a");
                linkElement.href = "#";
                linkElement.textContent = link;
                linkElement.onclick = () => navigateToPage(link);
                listItem.appendChild(linkElement);
                linksList.appendChild(listItem);
            });
        }

        // Function to check the optimal path using BFS
        async function checkOptimalPath() {
            const startPage = currentPage;
            const endPage = targetPage;

            if (!startPage || !endPage) {
                alert("Please provide both start and end Wikipedia pages.");
                return;
            }

            try {
                const response = await fetch(`http://localhost:5000/find_path?start_page=${startPage}&end_page=${endPage}`);

                if (!response.ok) {
                    const errorMessage = await response.text();
                    console.error('Error response:', response.status, errorMessage);
                    alert("An error occurred while fetching the path.");
                    return;
                }

                const data = await response.json();

                if (data.path) {
                    alert(`Optimal Path: ${data.path.join(' -> ')}`);
                } else {
                    alert(data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert("An error occurred while fetching the path.");
            }
        }

        // Initialize the game when the page loads
        window.onload = () => {
            generateRandomPage();
            trackIframeClicks();
        };
    </script>
</head>
<body>
    <div class="container">
        <h1>Wikipedia Path Finder Game</h1>

        <div class="info-box">
            <p><strong>Current Page:</strong> <span id="currentPage"></span></p>
            <p><strong>Target Page:</strong> <span id="targetPage"></span></p>
            <p id="moveCount">Moves: 0</p>
        </div>

        <div class="section-title">Navigate</div>
        <p>Select a link below to navigate from the current page:</p>
        <ul id="linksList" class="link-list"></ul>

        <button class="button" onclick="checkOptimalPath()">Check Optimal Path</button>

        <div class="section-title">Wikipedia Content</div>
        <iframe id="wikiIframe"></iframe>
    </div>

    <footer class="footer">
        <p>Powered by Bidirectional BFS | Developed by YourName</p>
    </footer>
</body>
</html>
